# WebUIå¯åŠ¨æ‰€éœ€æ¨¡å‹ä¸‹è½½æ¸…å• (è¯¦ç»†ç‰ˆ)

## ğŸ¯ æ ¹æ®æœ€æ–°é”™è¯¯æ—¥å¿—åˆ†æçš„å¿…éœ€æ¨¡å‹

### 1. **Stable Diffusion 1.5 ä¸»æ¨¡å‹** âœ…
**çŠ¶æ€**: å·²å­˜åœ¨ä½†å¯èƒ½ä¸å®Œæ•´

- **æ¨¡å‹åç§°**: Stable Diffusion v1.5 (pruned, ema-only)
- **æ–‡ä»¶å**: `v1-5-pruned-emaonly.safetensors`
- **ä¸‹è½½åœ°å€**: `https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.safetensors`
- **ç›®æ ‡ä½ç½®**: `D:\david\sd-webui\models\Stable-diffusion\v1-5-pruned-emaonly.safetensors`
- **æ–‡ä»¶å¤§å°**: 3.97GB (å®Œæ•´) / 2.27GB (å½“å‰æ˜¾ç¤º)
- **å½“å‰çŠ¶æ€**: æ–‡ä»¶å­˜åœ¨ï¼Œæƒé‡ID [6ce0161689]ï¼Œä½†å¯èƒ½ä¸å®Œæ•´
- **ä¸‹è½½è¿›åº¦**: 30% (682MB/2.27GB) - ä»åœ¨ä¸‹è½½ä¸­
- **é”™è¯¯ä¿¡æ¯**: `ChunkedEncodingError: Connection broken` (ç½‘ç»œä¸­æ–­)
- **ä¼˜å…ˆçº§**: ğŸ”¥ æœ€é«˜ (å¿…éœ€)

### 2. **CLIPæ–‡æœ¬ç¼–ç å™¨æ¨¡å‹** âŒ
**çŠ¶æ€**: ä¸¥é‡é”™è¯¯ - æ¨¡å‹è·¯å¾„ä¸ºNone

- **é—®é¢˜æ ¹æº**: WebUIé…ç½®ä¸­CLIPæ¨¡å‹è·¯å¾„ä¸º `None`ï¼Œå¯¼è‡´è®¿é—® `https://huggingface.co/None/`
- **æ­£ç¡®æ¨¡å‹**: CLIP ViT-Large-Patch14
- **æ­£ç¡®ä»“åº“**: `https://huggingface.co/openai/clip-vit-large-patch14`
- **éœ€è¦ä¸‹è½½çš„æ–‡ä»¶**:
  ```
  â”œâ”€â”€ config.json                    # æ¨¡å‹é…ç½®æ–‡ä»¶ (~2KB)
  â”œâ”€â”€ model.safetensors              # ä¸»æ¨¡å‹æƒé‡ (~1.7GB)
  â”œâ”€â”€ tokenizer.json                 # åˆ†è¯å™¨é…ç½® (~2.2MB)
  â”œâ”€â”€ tokenizer_config.json          # åˆ†è¯å™¨è®¾ç½® (~1KB)
  â”œâ”€â”€ vocab.json                     # è¯æ±‡è¡¨ (~1.1MB)
  â”œâ”€â”€ merges.txt                     # BPEåˆå¹¶è§„åˆ™ (~525KB)
  â””â”€â”€ special_tokens_map.json        # ç‰¹æ®Šæ ‡è®°æ˜ å°„ (~1KB)
  ```
- **ç›®æ ‡ä½ç½®**: `~/.cache/huggingface/transformers/models--openai--clip-vit-large-patch14/snapshots/[hash]/`
- **Windowsè·¯å¾„**: `C:\Users\david\.cache\huggingface\transformers\models--openai--clip-vit-large-patch14\`
- **é”™è¯¯ä¿¡æ¯**:
  - `OSError: None is not a local folder and is not a valid model identifier`
  - `401 Client Error: Unauthorized for url: https://huggingface.co/None/resolve/main/config.json`
- **ä¼˜å…ˆçº§**: ğŸ”¥ æœ€é«˜ (å¿…éœ€)

### 3. **å¤‡ç”¨CLIPæ¨¡å‹ä¸‹è½½åœ°å€**
ç”±äºç›´æ¥è®¿é—®å¯èƒ½å—é™ï¼Œæä¾›å¤‡ç”¨ä¸‹è½½æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆA: ä½¿ç”¨Hugging Faceé•œåƒ
- **é•œåƒç«™ç‚¹**: `https://hf-mirror.com/openai/clip-vit-large-patch14`
- **ä¸‹è½½å‘½ä»¤**: 
  ```bash
  export HF_ENDPOINT=https://hf-mirror.com
  huggingface-cli download openai/clip-vit-large-patch14
  ```

#### æ–¹æ¡ˆB: ç›´æ¥ä¸‹è½½é“¾æ¥
- **config.json**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/config.json`
- **model.safetensors**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/model.safetensors`
- **tokenizer.json**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/tokenizer.json`
- **tokenizer_config.json**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/tokenizer_config.json`
- **vocab.json**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/vocab.json`
- **merges.txt**: `https://huggingface.co/openai/clip-vit-large-patch14/resolve/main/merges.txt`

## ğŸ“ è¯¦ç»†ç›®å½•ç»“æ„

### WebUIæ¨¡å‹ç›®å½•
```
D:\david\sd-webui\models\
â”œâ”€â”€ Stable-diffusion\
â”‚   â””â”€â”€ v1-5-pruned-emaonly.safetensors     # 3.97GB âš ï¸
â”œâ”€â”€ VAE\                                     # (å¯é€‰)
â”œâ”€â”€ Lora\                                    # (å¯é€‰)
â”œâ”€â”€ ControlNet\                              # (å¯é€‰)
â”œâ”€â”€ ESRGAN\                                  # (å¯é€‰)
â”œâ”€â”€ GFPGAN\                                  # (å¯é€‰)
â””â”€â”€ embeddings\                              # (å¯é€‰)
```

### Hugging Faceç¼“å­˜ç›®å½•
```
~/.cache/huggingface/transformers/
â””â”€â”€ models--openai--clip-vit-large-patch14/
    â”œâ”€â”€ snapshots/
    â”‚   â””â”€â”€ [commit_hash]/
    â”‚       â”œâ”€â”€ config.json                  # ~2KB
    â”‚       â”œâ”€â”€ model.safetensors            # ~1.7GB âŒ
    â”‚       â”œâ”€â”€ tokenizer.json               # ~2.2MB
    â”‚       â”œâ”€â”€ tokenizer_config.json        # ~1KB
    â”‚       â”œâ”€â”€ vocab.json                   # ~1.1MB
    â”‚       â””â”€â”€ merges.txt                   # ~525KB
    â””â”€â”€ refs/
        â””â”€â”€ main                             # æŒ‡å‘å½“å‰commit
```

## ğŸ”§ ä¸‹è½½è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤SD 1.5æ¨¡å‹ä¸‹è½½
```python
# ä½¿ç”¨æ–­ç‚¹ç»­ä¼ ç»§ç»­ä¸‹è½½
import requests
import os

url = "https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.safetensors"
target = "D:/david/sd-webui/models/Stable-diffusion/v1-5-pruned-emaonly.safetensors"
temp_file = "D:/download/v1-5-pruned-emaonly.safetensors.tmp"

# æ£€æŸ¥å·²ä¸‹è½½å¤§å°
resume_pos = os.path.getsize(temp_file) if os.path.exists(temp_file) else 0
headers = {'Range': f'bytes={resume_pos}-'} if resume_pos > 0 else {}

# ç»§ç»­ä¸‹è½½
response = requests.get(url, headers=headers, stream=True)
```

### 2. ä¿®å¤CLIPæ¨¡å‹è®¿é—®
```bash
# æ–¹æ³•1: è®¾ç½®Hugging Faceé•œåƒ
export HF_ENDPOINT=https://hf-mirror.com

# æ–¹æ³•2: ä½¿ç”¨ä»£ç†
export HTTP_PROXY=http://your-proxy:port
export HTTPS_PROXY=http://your-proxy:port

# æ–¹æ³•3: æ‰‹åŠ¨ä¸‹è½½å¹¶æ”¾ç½®
mkdir -p ~/.cache/huggingface/transformers/models--openai--clip-vit-large-patch14/snapshots/main/
# ç„¶åå°†ä¸‹è½½çš„æ–‡ä»¶æ”¾å…¥è¯¥ç›®å½•
```

### 3. ä¿®å¤pydanticç‰ˆæœ¬å†²çª
```bash
# é™çº§pydanticåˆ°å…¼å®¹ç‰ˆæœ¬
venv\Scripts\python.exe -m pip install "pydantic<2.0" --force-reinstall
```

## ğŸ“Š ä¸‹è½½ä¼˜å…ˆçº§å’Œæ—¶é—´ä¼°ç®—

| æ¨¡å‹ | å¤§å° | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|------|--------|----------|------|
| SD 1.5 | 3.97GB | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | 30-60åˆ†é’Ÿ | âš ï¸ ä¸­æ–­ |
| CLIP | 1.7GB | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | 15-30åˆ†é’Ÿ | âŒ å¤±è´¥ |
| **æ€»è®¡** | **5.67GB** | - | **45-90åˆ†é’Ÿ** | - |

## ğŸ’¡ å»ºè®®çš„æ“ä½œæ­¥éª¤

### ç«‹å³æ‰§è¡Œ (è§£å†³å¯åŠ¨é—®é¢˜)
1. **ä¿®å¤pydanticç‰ˆæœ¬å†²çª**:
   ```bash
   venv\Scripts\python.exe -m pip install "pydantic<2.0" --force-reinstall
   ```

2. **é…ç½®Hugging Faceé•œåƒ** (è§£å†³CLIPä¸‹è½½):
   ```bash
   set HF_ENDPOINT=https://hf-mirror.com
   ```

3. **ä½¿ç”¨æ¨¡å‹ä¸‹è½½å™¨ç»§ç»­ä¸‹è½½SDæ¨¡å‹**:
   ```bash
   python model_downloader.py --model sd_1_5
   ```

### éªŒè¯å®‰è£…
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
python model_downloader.py --status

# é‡æ–°å¯åŠ¨WebUI
venv\Scripts\python.exe webui.py
```

## ğŸŒ ç½‘ç»œé—®é¢˜è§£å†³æ–¹æ¡ˆ

### å¦‚æœHugging Faceè®¿é—®å›°éš¾:
1. **ä½¿ç”¨å›½å†…é•œåƒ**: `https://hf-mirror.com`
2. **é…ç½®ä»£ç†**: è®¾ç½®HTTP/HTTPSä»£ç†
3. **æ‰‹åŠ¨ä¸‹è½½**: ä½¿ç”¨ä¸‹è½½å·¥å…·ä¸‹è½½åæ‰‹åŠ¨æ”¾ç½®
4. **ä½¿ç”¨VPN**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š

### å¦‚æœä¸‹è½½é€Ÿåº¦æ…¢:
1. **ä½¿ç”¨å¤šçº¿ç¨‹ä¸‹è½½å™¨**: aria2c, IDMç­‰
2. **é€‰æ‹©åˆé€‚çš„æ—¶é—´**: é¿å¼€ç½‘ç»œé«˜å³°æœŸ
3. **ä½¿ç”¨æœ‰çº¿ç½‘ç»œ**: ç¡®ä¿ç½‘ç»œç¨³å®šæ€§

è¿™ä¸ªæ¸…å•æ¶µç›–äº†WebUIå¯åŠ¨æ‰€éœ€çš„æ‰€æœ‰å…³é”®æ¨¡å‹ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§å®Œæˆä¸‹è½½å³å¯è§£å†³å¯åŠ¨é—®é¢˜ã€‚
